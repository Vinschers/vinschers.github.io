{{ define "main" }}
{{/* 1. Get the path defined in the content file's frontmatter */}}
{{ $targetPath := .Params.target_path | default "archive/" }}

{{/* 2. Try to find that section in the site */}}
{{ $section := .Site.GetPage $targetPath }}

<div class="print-container">

    {{ if $section }}
        <div class="print-header">
            <h1>Archive: {{ $section.Title }}</h1>
            <p>Generated: {{ now.Format "2006-01-02" }}</p>
        </div>

        {{/* 3. Recursive Loop: Try RegularPagesRecursive (New Hugo), fall back to RegularPages (Old Hugo) */}}
        {{ $pages := slice }}
        {{ if $section.RegularPagesRecursive }}
            {{ $pages = $section.RegularPagesRecursive }}
        {{ else }}
            {{ $pages = $section.RegularPages }}
        {{ end }}

        {{ range $pages.ByDate }}
            <article class="print-page">
                <!-- <div class="page-break"></div> -->
                <h1>{{ .Title }}</h1>
                <p class="meta">Published: {{ .Date.Format "2006-01-02" }}</p>
                <div class="content">
                    {{ .Content }}
                </div>
            </article>
            <hr>
        {{ end }}

    {{ else }}
        {{/* Error message if path is wrong */}}
        <h1>Error</h1>
        <p>Could not find content at path: <code>{{ $targetPath }}</code></p>
        <p>Please check your markdown file's <code>target_path</code> setting.</p>
    {{ end }}
    
</div>

{{/* Add your print CSS and Scripts here as before */}}
<style>
    @media print {
        @page { margin: 2cm; }
        header, footer, nav, aside { display: none !important; }
        html, body, main { width: 100% !important; margin: 0 !important; max-width: 100% !important; }
        .page-break { page-break-before: always; }
        details > * { display: block !important; } 
    }
</style>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll('details').forEach(el => el.open = true);
    });
</script>
{{ end }}
